<!DOCTYPE html>
<HTML lang = "en">
<HEAD>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Electrical Power Generation Problem - UC</title>
  

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      TeX: { equationNumbers: { autoNumber: "AMS" } }
    });
  </script>

  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

  
<style>
pre.hljl {
    border: 1px solid #ccc;
    margin: 5px;
    padding: 5px;
    overflow-x: auto;
    color: rgb(68,68,68); background-color: rgb(251,251,251); }
pre.hljl > span.hljl-t { }
pre.hljl > span.hljl-w { }
pre.hljl > span.hljl-e { }
pre.hljl > span.hljl-eB { }
pre.hljl > span.hljl-o { }
pre.hljl > span.hljl-k { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kc { color: rgb(59,151,46); font-style: italic; }
pre.hljl > span.hljl-kd { color: rgb(214,102,97); font-style: italic; }
pre.hljl > span.hljl-kn { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kp { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kr { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kt { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-n { }
pre.hljl > span.hljl-na { }
pre.hljl > span.hljl-nb { }
pre.hljl > span.hljl-nbp { }
pre.hljl > span.hljl-nc { }
pre.hljl > span.hljl-ncB { }
pre.hljl > span.hljl-nd { color: rgb(214,102,97); }
pre.hljl > span.hljl-ne { }
pre.hljl > span.hljl-neB { }
pre.hljl > span.hljl-nf { color: rgb(66,102,213); }
pre.hljl > span.hljl-nfm { color: rgb(66,102,213); }
pre.hljl > span.hljl-np { }
pre.hljl > span.hljl-nl { }
pre.hljl > span.hljl-nn { }
pre.hljl > span.hljl-no { }
pre.hljl > span.hljl-nt { }
pre.hljl > span.hljl-nv { }
pre.hljl > span.hljl-nvc { }
pre.hljl > span.hljl-nvg { }
pre.hljl > span.hljl-nvi { }
pre.hljl > span.hljl-nvm { }
pre.hljl > span.hljl-l { }
pre.hljl > span.hljl-ld { color: rgb(148,91,176); font-style: italic; }
pre.hljl > span.hljl-s { color: rgb(201,61,57); }
pre.hljl > span.hljl-sa { color: rgb(201,61,57); }
pre.hljl > span.hljl-sb { color: rgb(201,61,57); }
pre.hljl > span.hljl-sc { color: rgb(201,61,57); }
pre.hljl > span.hljl-sd { color: rgb(201,61,57); }
pre.hljl > span.hljl-sdB { color: rgb(201,61,57); }
pre.hljl > span.hljl-sdC { color: rgb(201,61,57); }
pre.hljl > span.hljl-se { color: rgb(59,151,46); }
pre.hljl > span.hljl-sh { color: rgb(201,61,57); }
pre.hljl > span.hljl-si { }
pre.hljl > span.hljl-so { color: rgb(201,61,57); }
pre.hljl > span.hljl-sr { color: rgb(201,61,57); }
pre.hljl > span.hljl-ss { color: rgb(201,61,57); }
pre.hljl > span.hljl-ssB { color: rgb(201,61,57); }
pre.hljl > span.hljl-nB { color: rgb(59,151,46); }
pre.hljl > span.hljl-nbB { color: rgb(59,151,46); }
pre.hljl > span.hljl-nfB { color: rgb(59,151,46); }
pre.hljl > span.hljl-nh { color: rgb(59,151,46); }
pre.hljl > span.hljl-ni { color: rgb(59,151,46); }
pre.hljl > span.hljl-nil { color: rgb(59,151,46); }
pre.hljl > span.hljl-noB { color: rgb(59,151,46); }
pre.hljl > span.hljl-oB { color: rgb(102,102,102); font-weight: bold; }
pre.hljl > span.hljl-ow { color: rgb(102,102,102); font-weight: bold; }
pre.hljl > span.hljl-p { }
pre.hljl > span.hljl-c { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-ch { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cm { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cp { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cpB { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cs { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-csB { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-g { }
pre.hljl > span.hljl-gd { }
pre.hljl > span.hljl-ge { }
pre.hljl > span.hljl-geB { }
pre.hljl > span.hljl-gh { }
pre.hljl > span.hljl-gi { }
pre.hljl > span.hljl-go { }
pre.hljl > span.hljl-gp { }
pre.hljl > span.hljl-gs { }
pre.hljl > span.hljl-gsB { }
pre.hljl > span.hljl-gt { }
</style>



  <style type="text/css">
  @font-face {
  font-style: normal;
  font-weight: 300;
}
@font-face {
  font-style: normal;
  font-weight: 400;
}
@font-face {
  font-style: normal;
  font-weight: 600;
}
html {
  font-family: sans-serif; /* 1 */
  -ms-text-size-adjust: 100%; /* 2 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
menu,
nav,
section,
summary {
  display: block;
}
audio,
canvas,
progress,
video {
  display: inline-block; /* 1 */
  vertical-align: baseline; /* 2 */
}
audio:not([controls]) {
  display: none;
  height: 0;
}
[hidden],
template {
  display: none;
}
a:active,
a:hover {
  outline: 0;
}
abbr[title] {
  border-bottom: 1px dotted;
}
b,
strong {
  font-weight: bold;
}
dfn {
  font-style: italic;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
mark {
  background: #ff0;
  color: #000;
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sup {
  top: -0.5em;
}
sub {
  bottom: -0.25em;
}
img {
  border: 0;
}
svg:not(:root) {
  overflow: hidden;
}
figure {
  margin: 1em 40px;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}
pre {
  overflow: auto;
}
code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}
button,
input,
optgroup,
select,
textarea {
  color: inherit; /* 1 */
  font: inherit; /* 2 */
  margin: 0; /* 3 */
}
button {
  overflow: visible;
}
button,
select {
  text-transform: none;
}
button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
  -webkit-appearance: button; /* 2 */
  cursor: pointer; /* 3 */
}
button[disabled],
html input[disabled] {
  cursor: default;
}
button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}
input {
  line-height: normal;
}
input[type="checkbox"],
input[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  height: auto;
}
input[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box; /* 2 */
  box-sizing: content-box;
}
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}
fieldset {
  border: 1px solid #c0c0c0;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}
legend {
  border: 0; /* 1 */
  padding: 0; /* 2 */
}
textarea {
  overflow: auto;
}
optgroup {
  font-weight: bold;
}
table {
  font-family: monospace, monospace;
  font-size : 0.8em;
  border-collapse: collapse;
  border-spacing: 0;
}
td,
th {
  padding: 0;
}
thead th {
    border-bottom: 1px solid black;
    background-color: white;
}
tr:nth-child(odd){
  background-color: rgb(248,248,248);
}


/*
* Skeleton V2.0.4
* Copyright 2014, Dave Gamache
* www.getskeleton.com
* Free to use under the MIT license.
* http://www.opensource.org/licenses/mit-license.php
* 12/29/2014
*/
.container {
  position: relative;
  width: 100%;
  max-width: 960px;
  margin: 0 auto;
  padding: 0 20px;
  box-sizing: border-box; }
.column,
.columns {
  width: 100%;
  float: left;
  box-sizing: border-box; }
@media (min-width: 400px) {
  .container {
    width: 85%;
    padding: 0; }
}
@media (min-width: 550px) {
  .container {
    width: 80%; }
  .column,
  .columns {
    margin-left: 4%; }
  .column:first-child,
  .columns:first-child {
    margin-left: 0; }

  .one.column,
  .one.columns                    { width: 4.66666666667%; }
  .two.columns                    { width: 13.3333333333%; }
  .three.columns                  { width: 22%;            }
  .four.columns                   { width: 30.6666666667%; }
  .five.columns                   { width: 39.3333333333%; }
  .six.columns                    { width: 48%;            }
  .seven.columns                  { width: 56.6666666667%; }
  .eight.columns                  { width: 65.3333333333%; }
  .nine.columns                   { width: 74.0%;          }
  .ten.columns                    { width: 82.6666666667%; }
  .eleven.columns                 { width: 91.3333333333%; }
  .twelve.columns                 { width: 100%; margin-left: 0; }

  .one-third.column               { width: 30.6666666667%; }
  .two-thirds.column              { width: 65.3333333333%; }

  .one-half.column                { width: 48%; }

  /* Offsets */
  .offset-by-one.column,
  .offset-by-one.columns          { margin-left: 8.66666666667%; }
  .offset-by-two.column,
  .offset-by-two.columns          { margin-left: 17.3333333333%; }
  .offset-by-three.column,
  .offset-by-three.columns        { margin-left: 26%;            }
  .offset-by-four.column,
  .offset-by-four.columns         { margin-left: 34.6666666667%; }
  .offset-by-five.column,
  .offset-by-five.columns         { margin-left: 43.3333333333%; }
  .offset-by-six.column,
  .offset-by-six.columns          { margin-left: 52%;            }
  .offset-by-seven.column,
  .offset-by-seven.columns        { margin-left: 60.6666666667%; }
  .offset-by-eight.column,
  .offset-by-eight.columns        { margin-left: 69.3333333333%; }
  .offset-by-nine.column,
  .offset-by-nine.columns         { margin-left: 78.0%;          }
  .offset-by-ten.column,
  .offset-by-ten.columns          { margin-left: 86.6666666667%; }
  .offset-by-eleven.column,
  .offset-by-eleven.columns       { margin-left: 95.3333333333%; }

  .offset-by-one-third.column,
  .offset-by-one-third.columns    { margin-left: 34.6666666667%; }
  .offset-by-two-thirds.column,
  .offset-by-two-thirds.columns   { margin-left: 69.3333333333%; }

  .offset-by-one-half.column,
  .offset-by-one-half.columns     { margin-left: 52%; }

}
html {
  font-size: 62.5%; }
body {
  font-size: 1.5em; /* currently ems cause chrome bug misinterpreting rems on body element */
  line-height: 1.6;
  font-weight: 400;
  font-family: "Raleway", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial, sans-serif;
  color: #222; }
h1, h2, h3, h4, h5, h6 {
  margin-top: 0;
  margin-bottom: 2rem;
  font-weight: 300; }
h1 { font-size: 3.6rem; line-height: 1.2;  letter-spacing: -.1rem;}
h2 { font-size: 3.4rem; line-height: 1.25; letter-spacing: -.1rem; }
h3 { font-size: 3.2rem; line-height: 1.3;  letter-spacing: -.1rem; }
h4 { font-size: 2.8rem; line-height: 1.35; letter-spacing: -.08rem; }
h5 { font-size: 2.4rem; line-height: 1.5;  letter-spacing: -.05rem; }
h6 { font-size: 1.5rem; line-height: 1.6;  letter-spacing: 0; }

p {
  margin-top: 0; }
a {
  color: #1EAEDB; }
a:hover {
  color: #0FA0CE; }
.button,
button,
input[type="submit"],
input[type="reset"],
input[type="button"] {
  display: inline-block;
  height: 38px;
  padding: 0 30px;
  color: #555;
  text-align: center;
  font-size: 11px;
  font-weight: 600;
  line-height: 38px;
  letter-spacing: .1rem;
  text-transform: uppercase;
  text-decoration: none;
  white-space: nowrap;
  background-color: transparent;
  border-radius: 4px;
  border: 1px solid #bbb;
  cursor: pointer;
  box-sizing: border-box; }
.button:hover,
button:hover,
input[type="submit"]:hover,
input[type="reset"]:hover,
input[type="button"]:hover,
.button:focus,
button:focus,
input[type="submit"]:focus,
input[type="reset"]:focus,
input[type="button"]:focus {
  color: #333;
  border-color: #888;
  outline: 0; }
.button.button-primary,
button.button-primary,
input[type="submit"].button-primary,
input[type="reset"].button-primary,
input[type="button"].button-primary {
  color: #FFF;
  background-color: #33C3F0;
  border-color: #33C3F0; }
.button.button-primary:hover,
button.button-primary:hover,
input[type="submit"].button-primary:hover,
input[type="reset"].button-primary:hover,
input[type="button"].button-primary:hover,
.button.button-primary:focus,
button.button-primary:focus,
input[type="submit"].button-primary:focus,
input[type="reset"].button-primary:focus,
input[type="button"].button-primary:focus {
  color: #FFF;
  background-color: #1EAEDB;
  border-color: #1EAEDB; }
input[type="email"],
input[type="number"],
input[type="search"],
input[type="text"],
input[type="tel"],
input[type="url"],
input[type="password"],
textarea,
select {
  height: 38px;
  padding: 6px 10px; /* The 6px vertically centers text on FF, ignored by Webkit */
  background-color: #fff;
  border: 1px solid #D1D1D1;
  border-radius: 4px;
  box-shadow: none;
  box-sizing: border-box; }
/* Removes awkward default styles on some inputs for iOS */
input[type="email"],
input[type="number"],
input[type="search"],
input[type="text"],
input[type="tel"],
input[type="url"],
input[type="password"],
textarea {
  -webkit-appearance: none;
     -moz-appearance: none;
          appearance: none; }
textarea {
  min-height: 65px;
  padding-top: 6px;
  padding-bottom: 6px; }
input[type="email"]:focus,
input[type="number"]:focus,
input[type="search"]:focus,
input[type="text"]:focus,
input[type="tel"]:focus,
input[type="url"]:focus,
input[type="password"]:focus,
textarea:focus,
select:focus {
  border: 1px solid #33C3F0;
  outline: 0; }
label,
legend {
  display: block;
  margin-bottom: .5rem;
  font-weight: 600; }
fieldset {
  padding: 0;
  border-width: 0; }
input[type="checkbox"],
input[type="radio"] {
  display: inline; }
label > .label-body {
  display: inline-block;
  margin-left: .5rem;
  font-weight: normal; }
ul {
  list-style: circle; }
ol {
  list-style: decimal; }
ul ul,
ul ol,
ol ol,
ol ul {
  margin: 1.5rem 0 1.5rem 3rem;
  font-size: 90%; }
li > p {margin : 0;}
th,
td {
  padding: 12px 15px;
  text-align: left;
  border-bottom: 1px solid #E1E1E1; }
th:first-child,
td:first-child {
  padding-left: 0; }
th:last-child,
td:last-child {
  padding-right: 0; }
button,
.button {
  margin-bottom: 1rem; }
input,
textarea,
select,
fieldset {
  margin-bottom: 1.5rem; }
pre,
blockquote,
dl,
figure,
table,
p,
ul,
ol,
form {
  margin-bottom: 1.0rem; }
.u-full-width {
  width: 100%;
  box-sizing: border-box; }
.u-max-full-width {
  max-width: 100%;
  box-sizing: border-box; }
.u-pull-right {
  float: right; }
.u-pull-left {
  float: left; }
hr {
  margin-top: 3rem;
  margin-bottom: 3.5rem;
  border-width: 0;
  border-top: 1px solid #E1E1E1; }
.container:after,
.row:after,
.u-cf {
  content: "";
  display: table;
  clear: both; }

pre {
  display: block;
  padding: 9.5px;
  margin: 0 0 10px;
  font-size: 13px;
  line-height: 1.42857143;
  word-break: break-all;
  word-wrap: break-word;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre.hljl {
  margin: 0 0 10px;
  display: block;
  background: #f5f5f5;
  border-radius: 4px;
  padding : 5px;
}

pre.output {
  background: #ffffff;
}

pre.code {
  background: #ffffff;
}

pre.julia-error {
  color : red
}

code,
kbd,
pre,
samp {
  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
  font-size: 0.9em;
}


@media (min-width: 400px) {}
@media (min-width: 550px) {}
@media (min-width: 750px) {}
@media (min-width: 1000px) {}
@media (min-width: 1200px) {}

h1.title {margin-top : 20px}
img {max-width : 100%}
div.title {text-align: center;}

  </style>
</HEAD>

<BODY>
  <div class ="container">
    <div class = "row">
      <div class = "col-md-12 twelve columns">
        <div class="title">
          <h1 class="title">Electrical Power Generation Problem - UC</h1>
          <h5>Welington de Oliveira</h5>
          <h5>November, 25th 2024</h5>
        </div>

        <h2>Objective and Prerequisites</h2>
<p>This model is an example of an electrical power generation problem &#40;also known as a unit commitment problem&#41;. It selects an optimal set of power stations to turn on in order to satisfy anticipated power demand over a 24-hour time horizon.  This example is modified by W. de Oliveira &#40;www.oliveira.mat.br&#41;. The goal is to extend the basic model to a stochastic setting, using a probability constraint.</p>
<p>The basic model is example 16 from the fifth edition of Model Building in Mathematical Programming, by H. Paul Williams on pages 271-272 and 326-327.</p>
<p>The following project is implemented in Julia, using the optimization modeler JuMP.</p>
<ul>
<li><p>If you are new to the Julia language, we recommend the <a href="https://jump.dev/JuMP.jl/stable/tutorials/getting_started/getting_started_with_julia/">following introduction</a>.</p>
</li>
<li><p>If you are new to optimization modeler, we recommend the <a href="https://jump.dev/JuMP.jl/stable/tutorials/getting_started/getting_started_with_JuMP/">following tutorial</a>.</p>
</li>
</ul>
<hr />
<h2>Problem Description</h2>
<p>In this problem, thermal power generation units are grouped into three distinct types, with different characteristics for each type &#40;power output, cost per megawatt hour, startup cost, etc.&#41;.  A unit can be on or off, with a startup cost associated with transitioning from off to on, and power output that can fall anywhere between a specified minimum and maximum value when the unit is on.  There are also two hydroelectric plants available, also with different cost and power generation characteristics.  A 24-hour time horizon is divided into 5 discrete time periods. Except for the first period, which is assumed detetministic,  total power demand is random. Given a possible realization of the random vector of power demand, the basic model decides which units to turn on, and when, in order to satisfy the <em>given demand</em> for each time period.  The model also captures a reserve requirement, where the selected power plants must be capable of increasing their output, while still respecting their maximum output, in order to cope with the situation where actual demand exceeds predicted demand.</p>
<p>A set of generators is available to satisfy power demand for the following day.  The average demand is as follows:</p>
<table><tr><th>Time Period</th><th>Avg Demand &#40;megawatts&#41;</th></tr><tr><td>12 pm to 6 am</td><td>15000</td></tr><tr><td>6 am to 9 am</td><td>30000</td></tr><tr><td>9 am to 3 pm</td><td>25000</td></tr><tr><td>3 pm to 6 pm</td><td>40000</td></tr><tr><td>6 pm to 12 pm</td><td>27000</td></tr></table>
<p>Thermal generators are grouped into three types, with the following minimum and maximum output for each type &#40;when they are on&#41;:</p>
<table><tr><th>Type</th><th>Number available</th><th>Minimum output &#40;MW&#41;</th><th>Maximum output &#40;MW&#41;</th></tr><tr><td>0</td><td>12</td><td>850</td><td>2000</td></tr><tr><td>1</td><td>10</td><td>1250</td><td>1750</td></tr><tr><td>2</td><td>5</td><td>1500</td><td>4000</td></tr></table>
<p>There are costs associated with using a thermal generator: a cost per hour when the generator is on &#40;and generating its minimum output&#41;, a cost per megawatt hour above its minimum, and a startup cost for turning a generator on:</p>
<table><tr><th>Type</th><th>Cost per hour &#40;when on&#41;</th><th>Cost per MWh above minimum</th><th>Startup cost</th></tr><tr><td>0</td><td><span class="math">$\$1000$</span></td><td><span class="math">$\$2.00$</span></td><td><span class="math">$\$2000$</span></td></tr><tr><td>1</td><td><span class="math">$\$2600$</span></td><td><span class="math">$\$1.30$</span></td><td><span class="math">$\$1000$</span></td></tr><tr><td>2</td><td><span class="math">$\$3000$</span></td><td><span class="math">$\$3.00$</span></td><td><span class="math">$\$500$</span></td></tr></table>
<p>Two hydroelectric generators are also available, each with a fixed power output &#40;when on&#41;:</p>
<table><tr><th>Hydro plant</th><th>Output &#40;MW&#41;</th></tr><tr><td>A</td><td>900</td></tr><tr><td>B</td><td>1400</td></tr></table>
<p>The costs associated with using a hydro plant are slightly different.  There&#39;s an hourly cost, but it is much smaller than the hourly cost of a thermal generator.  The real cost for a hydroelectric plant comes from depletion of the water in the reservoir, which happens at different rates for the two units.  The reservoir must be replenished before the end of the time horizon by pumping water into it, which consumes electricity.  A hydroelectric plant also has a startup cost.</p>
<table><tr><th>Hydro plant</th><th>Cost per hour &#40;when on&#41;</th><th>Startup cost</th><th>Reservoir depth reduction &#40;m/hr&#41;</th></tr><tr><td>A</td><td><span class="math">$\$90$</span></td><td><span class="math">$\$1500$</span></td><td>0.31</td></tr><tr><td>B</td><td><span class="math">$\$150$</span></td><td><span class="math">$\$1200$</span></td><td>0.47</td></tr></table>
<p>Pumping water into the reservoir consumes electricity at a rate of 3000 MWh of electricity per meter of height.  The height of the reservoir at the end of the time horizon must be equal to the height at the beginning.</p>
<hr />
<h2>Model Formulation: Desterministic Setting</h2>
<p>Given a scenario demand, i.e., a possible realization of the future random demand, the question we wish to answer is: which generators should be committed to meet anticipated demand in order to minimize total cost?</p>
<h3>Sets and Indices</h3>
<ul>
<li><p><span class="math">$t \in \text{Types}=\{0,1,2\}$</span>: Types of thermal generators.</p>
</li>
<li><p><span class="math">$h \in \text{HydroUnits}=\{0,1\}$</span>: Two hydro generators.</p>
</li>
<li><p><span class="math">$p \in \text{Periods}=\{0,1,2,3,4\}$</span>: Time periods.</p>
</li>
</ul>
<h3>Parameters</h3>
<ul>
<li><p><span class="math">$\text{period_hours}_{p} \in \mathbb{N}^+$</span>: Number of hours in each time period.</p>
</li>
<li><p><span class="math">$\text{demand}_p \in \mathbb{R}^+$</span>: Total power demand for time period <span class="math">$p$</span>.</p>
</li>
<li><p><span class="math">$\text{generators}_t \in \mathbb{N}^+$</span>: Number of thermal generators of type <span class="math">$t$</span>.</p>
</li>
<li><p><span class="math">$\text{start0} \in \mathbb{N}^+$</span>: Number of thermal generators that are on at the beginning of the time horizon &#40;and available in time period 0 without paying a startup cost&#41;.</p>
</li>
<li><p><span class="math">$\text{min_output}_t \in \mathbb{R}^+$</span>: Minimum output for thermal generator type <span class="math">$t$</span> &#40;when on&#41;.</p>
</li>
<li><p><span class="math">$\text{max_output}_t \in \mathbb{R}^+$</span>: Maximum output for thermal generator type <span class="math">$t$</span>.</p>
</li>
<li><p><span class="math">$\text{base_cost}_t \in \mathbb{R}^+$</span>: Minimum operating cost &#40;per hour&#41; for a thermal generator of type <span class="math">$t$</span>.</p>
</li>
<li><p><span class="math">$\text{per_mw_cost}_t \in \mathbb{R}^+$</span>: Cost to generate one additional MW &#40;per hour&#41; for a thermal generator of type <span class="math">$t$</span>.</p>
</li>
<li><p><span class="math">$\text{startup_cost}_t \in \mathbb{R}^+$</span>: Startup cost for thermal generator of type <span class="math">$t$</span>.</p>
</li>
<li><p><span class="math">$\text{hydro_load}_h \in \mathbb{R}^+$</span>: Output for hydro generator <span class="math">$h$</span>.</p>
</li>
<li><p><span class="math">$\text{hydro_cost}_h \in \mathbb{R}^+$</span>: Cost for operating hydro generator <span class="math">$h$</span>.</p>
</li>
<li><p><span class="math">$\text{hydro_startup_cost}_h \in \mathbb{R}^+$</span>: Startup cost for hydro generator <span class="math">$h$</span>.</p>
</li>
<li><p><span class="math">$\text{hydro_height_reduction}_h \in \mathbb{R}^+$</span>: Hourly reduction in reservoir height from operating hydro generator <span class="math">$h$</span>.</p>
</li>
</ul>
<h3>Decision Variables</h3>
<ul>
<li><p><span class="math">$\text{ngen}_{t,p} \in \mathbb{N}^+$</span>: Number of thermal generators of type <span class="math">$t$</span> that are on in time period <span class="math">$p$</span>.</p>
</li>
<li><p><span class="math">$\text{output}_{t,p} \in \mathbb{R}^+$</span>: Total power output from thermal generators of type <span class="math">$t$</span> in time period <span class="math">$p$</span>.</p>
</li>
<li><p><span class="math">$\text{nstart}_{t,p} \in \mathbb{N}^+$</span>: Number of thermal generators of type <span class="math">$t$</span> to start in time period <span class="math">$p$</span>.</p>
</li>
<li><p><span class="math">$\text{hydro}_{h,p} \in [0,1]$</span>: Indicates whether hydro generators <span class="math">$h$</span> is on in time period <span class="math">$p$</span>.</p>
</li>
<li><p><span class="math">$\text{hydro_start}_{h,p} \in [0,1]$</span>: Indicates whether hydro generator <span class="math">$h$</span> starts in time period <span class="math">$p$</span>.</p>
</li>
<li><p><span class="math">$\text{height}_{p} \in \mathbb{R}^+$</span>: Height of reservoir in time period <span class="math">$p$</span>.</p>
</li>
<li><p><span class="math">$\text{pumping}_{p} \in \mathbb{R}^+$</span>: Power used to replenish reservoir in time period <span class="math">$p$</span>.</p>
</li>
</ul>
<h3>Objective Function</h3>
<ul>
<li><p><strong>Cost</strong>: Minimize the cost &#40;in USD&#41; to satisfy the predicted electricity demand.</p>
</li>
</ul>
<p class="math">\[
\text{Minimize} \quad Z_{on} + Z_{extra} + Z_{startup} + Z_{hydro} + Z_{hydro\_startup}
\]</p>
<p class="math">\[
Z_{on} = \sum_{(t,p) \in \text{Types} \times \text{Periods}}{\text{base_cost}_t*\text{ngen}_{t,p}}
\]</p>
<p class="math">\[
Z_{extra} = \sum_{(t,p) \in \text{Types} \times \text{Periods}}{\text{per_mw_cost}_t*(\text{output}_{t,p} - \text{min_load}_t})
\]</p>
<p class="math">\[
Z_{startup} = \sum_{(t,p) \in \text{Types} \times \text{Periods}}{\text{startup_cost}_t*\text{nstart}_{t,p}}
\]</p>
<p class="math">\[
Z_{hydro} = \sum_{(h,p) \in \text{HydroUnits} \times \text{Periods}}{\text{hydro_cost}_h*\text{hydro}_{h,p}}
\]</p>
<p class="math">\[
Z_{hydro\_startup} = \sum_{(h,p) \in \text{HydroUnits} \times \text{Periods}}{\text{hydro_startup_cost}_h*\text{hydro_start}_{h,p}}
\]</p>
<h3>Constraints</h3>
<ul>
<li><p><strong>Available generators</strong> &#40;SetCons #1&#41;: Number of generators used must be less than or equal to the number available.</p>
</li>
</ul>
<p class="math">\[
\text{ngen}_{t,p} \leq \text{generators}_t  \quad \forall (t,p) \in \text{Types} \times \text{Periods}
\]</p>
<ul>
<li><p><strong>Min/max generation</strong> &#40;SetCons #2&#41;: Power generation must respect thermal generator min/max values.</p>
</li>
</ul>
<p class="math">\[
\text{output}_{t,p} \geq \text{min_output}_t*\text{ngen}_{t,p} \quad \forall (t,p) \in \text{Types} \times \text{Periods}
\]</p>
<p class="math">\[
\text{output}_{t,p} \leq \text{max_output}_t*\text{ngen}_{t,p} \quad \forall (t,p) \in \text{Types} \times \text{Periods}
\]</p>
<ul>
<li><p><strong>Thermal startup</strong> &#40;SetCons #3&#41;: Establish relationship between number of active thermal generators and number of startups &#40;use <span class="math">$start0$</span> for period before the time horizon starts&#41;</p>
</li>
</ul>
<p class="math">\[
\text{ngen}_{t,p} \leq \text{ngen}_{t,p-1} + \text{nstart}_{t,p} \quad \forall (t,p) \in \text{Types} \times \text{Periods}
\]</p>
<ul>
<li><p><strong>Hydro startup</strong> &#40;SetCons #4&#41;: Establish relationship between hydro generator state and number of hydro startups &#40;assume hydro plants are off at the beginning of the horizon&#41;</p>
</li>
</ul>
<p class="math">\[
\text{hydro}_{h,p} \leq \text{hydro}_{h,p-1} + \text{hydro_start}_{h,p} \quad \forall (h,p) \in \text{HydroUnits} \times \text{Periods}
\]</p>
<ul>
<li><p><strong>Reservoir height</strong> &#40;SetCons #5&#41;: Track reservoir height.   Note that the height at the end of the final time period must equal the height at the beginning of the first.</p>
</li>
<li><p>Reservoir level constraints: Height increases due to pumping activity and decreases due to hydroelectric generation.</p>
</li>
</ul>
<p class="math">\[
\text{height}_{p} = \text{height}_{p-1}  + \text{period_hours}_{p}*\text{pumping}_{p}/3000 -
\sum_{h \in \text{HydroUnits}}{\text{period_hours}_{p}*\text{hydro_height_reduction}_{h}*\text{hydro}_{h,p}} \quad \forall p \in \text{Periods}
\]</p>
<ul>
<li><p>Cyclic constraint: Height at the first period must be equal to height at the last period.</p>
</li>
</ul>
<p class="math">\[
\text{height}_{pfirst} = \text{height}_{plast}  + \text{period_hours}_{pfirst}*\text{pumping}_{pfirst}/3000 -
\sum_{h \in \text{HydroUnits}}{\text{period_hours}_{pfirst}*\text{hydro_height_reduction}_{h}*\text{hydro}_{h,pfirst}}
\]</p>
<ul>
<li><p><strong>Demand</strong> &#40;SetCons #6&#41;: Total power generated across all generator types must meet the given demand scenario plus pumping for each time period <span class="math">$p$</span>.</p>
</li>
</ul>
<p class="math">\[
\sum_{t \in \text{Types}}{\text{output}_{t,p}} +
\sum_{h \in \text{HydroUnits}}{\text{hydro_load}_h*\text{hydro}_{h,p}} \geq
\text{demand}_p + \text{pumping}_p \quad \forall p \in \text{Periods}
\]</p>
<hr />
<h2>Jullia implementation</h2>


<pre class='hljl'>
<span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>JuMP</span><span class='hljl-t'>
</span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>HiGHS</span><span class='hljl-t'>
</span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>Plots</span>
</pre>



<h2>Input Data</h2>
<p>We define all the input data of the model.</p>


<pre class='hljl'>
<span class='hljl-cs'># Parameters</span><span class='hljl-t'>
</span><span class='hljl-n'>ntypes</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>3</span><span class='hljl-t'>
</span><span class='hljl-n'>nperiods</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>5</span><span class='hljl-t'>
</span><span class='hljl-n'>maxstart0</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>5</span><span class='hljl-t'>
</span><span class='hljl-n'>hydrounits</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>2</span><span class='hljl-t'>
</span><span class='hljl-n'>Nscen</span><span class='hljl-t'>      </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>1000</span><span class='hljl-t'>

</span><span class='hljl-n'>generators</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>12</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>10</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>5</span><span class='hljl-p'>]</span><span class='hljl-t'>
</span><span class='hljl-n'>period_hours</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>6</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>3</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>6</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>3</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>6</span><span class='hljl-p'>]</span><span class='hljl-t'>

</span><span class='hljl-cs'># Average of the random demand</span><span class='hljl-t'>
</span><span class='hljl-n'>demand</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>15000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>30000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>25000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>40000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>27000</span><span class='hljl-p'>]</span><span class='hljl-t'>

</span><span class='hljl-n'>min_load</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>850</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1250</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1500</span><span class='hljl-p'>]</span><span class='hljl-t'>
</span><span class='hljl-n'>max_load</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>2000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1750</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>4000</span><span class='hljl-p'>]</span><span class='hljl-t'>
</span><span class='hljl-n'>base_cost</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>1000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>2600</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>3000</span><span class='hljl-p'>]</span><span class='hljl-t'>
</span><span class='hljl-n'>per_mw_cost</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nfB'>1.3</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>3</span><span class='hljl-p'>]</span><span class='hljl-t'>
</span><span class='hljl-n'>startup_cost</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>2000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>500</span><span class='hljl-p'>]</span><span class='hljl-t'>

</span><span class='hljl-n'>hydro_load</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>900</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1400</span><span class='hljl-p'>]</span><span class='hljl-t'>
</span><span class='hljl-n'>hydro_cost</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>90</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>150</span><span class='hljl-p'>]</span><span class='hljl-t'>
</span><span class='hljl-n'>hydro_height_reduction</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-nfB'>0.31</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nfB'>0.47</span><span class='hljl-p'>]</span><span class='hljl-t'>
</span><span class='hljl-n'>hydro_startup_cost</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>1500</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1200</span><span class='hljl-p'>]</span>
</pre>



<h2>Deterministic Model</h2>
<p>We create a model and the variables. For each time period, we have:</p>
<ul>
<li><p>an integer decision variable to capture the number of active</p>
</li>
</ul>
<p>generators of each type &#40;ngen&#41;,</p>
<ul>
<li><p>an integer variable to capture the number of generators of each type we must start &#40;nstart&#41;,</p>
</li>
<li><p>a continuous decision variable to capture the total power output for each generator type &#40;output&#41;,</p>
</li>
<li><p>a binary decision variable that indicates whether a hydro unit is active &#40;hydro&#41;,</p>
</li>
<li><p>a binary decision variable that indicates whether a hydro unit must be started &#40;hydrstart&#41;,</p>
</li>
<li><p>a continuous decision variable that captures the amount of enery used to replenish the reservoir &#40;pumping&#41;, and</p>
</li>
<li><p>a continuous decision variable that captures the height of the reservoir &#40;height&#41;.</p>
</li>
</ul>


<pre class='hljl'>
<span class='hljl-n'>model</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>Model</span><span class='hljl-p'>(</span><span class='hljl-n'>HiGHS</span><span class='hljl-oB'>.</span><span class='hljl-n'>Optimizer</span><span class='hljl-p'>)</span><span class='hljl-t'>

</span><span class='hljl-nd'>@variable</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ngen</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>Int</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nd'>@variable</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>nstart</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>Int</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nd'>@variable</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>output</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>])</span><span class='hljl-t'>

</span><span class='hljl-nd'>@variable</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>hydro</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>hydrounits</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>Bin</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nd'>@variable</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>hydrostart</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>hydrounits</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>Bin</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nd'>@variable</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>pumping</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-nd'>@variable</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>height</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>])</span>
</pre>



<hr />
<h3>Objective</h3>
<p>Minimize total cost. Cost consists of five components: the cost for running active thermal generation units, the cost to generate power beyond the minimum for each unit, the cost to start up thermal generation units, the cost to operate hydro units, and the cost to start up hydro units.</p>


<pre class='hljl'>
<span class='hljl-cs'># Objective: minimize total cost</span><span class='hljl-t'>
</span><span class='hljl-nd'>@expression</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>active</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-n'>base_cost</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>period_hours</span><span class='hljl-p'>[</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>ngen</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>type</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-nd'>@expression</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>per_mw</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-n'>per_mw_cost</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>period_hours</span><span class='hljl-p'>[</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-p'>(</span><span class='hljl-n'>output</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-t'> </span><span class='hljl-n'>min_load</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>ngen</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>])</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>type</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-nd'>@expression</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>startup_obj</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-n'>startup_cost</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>nstart</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>type</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-nd'>@expression</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>hydro_active</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-n'>hydro_cost</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>period_hours</span><span class='hljl-p'>[</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>hydro</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>unit</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>hydrounits</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-nd'>@expression</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>hydro_startup</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-n'>hydro_startup_cost</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>hydrostart</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>unit</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>hydrounits</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>))</span><span class='hljl-t'>

</span><span class='hljl-nd'>@objective</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>Min</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>active</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>per_mw</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>startup_obj</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>hydro_active</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>hydro_startup</span><span class='hljl-p'>)</span>
</pre>



<hr />
<h3>Constraints</h3>
<p>Next we insert the constraints:</p>
<ul>
<li><p>SetCons #1. The number of active generators can&#39;t exceed the number of generators:</p>
</li>
</ul>


<pre class='hljl'>
<span class='hljl-cs'># Generator count</span><span class='hljl-t'>
</span><span class='hljl-nd'>@constraint</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>numgen</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>ngen</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>&lt;=</span><span class='hljl-t'> </span><span class='hljl-n'>generators</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>])</span>
</pre>



<ul>
<li><p>SetCons #2. Total power output for a thermal generator type depends on the number of generators of that type that are active.</p>
</li>
</ul>


<pre class='hljl'>
<span class='hljl-cs'># Respect minimum and maximum output per generator type</span><span class='hljl-t'>
</span><span class='hljl-nd'>@constraint</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>min_output</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>output</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>&gt;=</span><span class='hljl-t'> </span><span class='hljl-n'>min_load</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-t'> </span><span class='hljl-n'>ngen</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-nd'>@constraint</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>max_output</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>output</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>&lt;=</span><span class='hljl-t'> </span><span class='hljl-n'>max_load</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-t'> </span><span class='hljl-n'>ngen</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-p'>])</span>
</pre>



<ul>
<li><p>SetCons #3. Connect the decision variables that capture active thermal generators with the decision variables that count startups.</p>
</li>
</ul>


<pre class='hljl'>
<span class='hljl-cs'># Startup constraint</span><span class='hljl-t'>
</span><span class='hljl-nd'>@constraint</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>startup0</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>ngen</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>&lt;=</span><span class='hljl-t'> </span><span class='hljl-n'>maxstart0</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>nstart</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-nd'>@constraint</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>startup</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-oB'>=</span><span class='hljl-ni'>2</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>ngen</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>&lt;=</span><span class='hljl-t'> </span><span class='hljl-n'>ngen</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-oB'>-</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>nstart</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>])</span>
</pre>



<ul>
<li><p>SetCons #4. Connect hydro decision variables with hydro startup decision variables.</p>
</li>
</ul>


<pre class='hljl'>
<span class='hljl-cs'># Hydro startup constraint</span><span class='hljl-t'>
</span><span class='hljl-nd'>@constraint</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>hydro_startup0_cons</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>hydrounits</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>hydro</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>&lt;=</span><span class='hljl-t'> </span><span class='hljl-n'>hydrostart</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-nd'>@constraint</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>hydro_startup_cons</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>hydrounits</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-oB'>=</span><span class='hljl-ni'>2</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>hydro</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>&lt;=</span><span class='hljl-t'> </span><span class='hljl-n'>hydro</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-oB'>-</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>hydrostart</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>])</span>
</pre>



<ul>
<li><p>SetCons #5. Maintain appropriate reservoir levels</p>
</li>
</ul>


<pre class='hljl'>
<span class='hljl-cs'># Reservoir levels</span><span class='hljl-t'>
</span><span class='hljl-nd'>@constraint</span><span class='hljl-p'>(</span><span class='hljl-t'>
    </span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>reservoir</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>hydrounits</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-oB'>=</span><span class='hljl-ni'>2</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>],</span><span class='hljl-t'>
    </span><span class='hljl-n'>height</span><span class='hljl-p'>[</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>==</span><span class='hljl-t'> </span><span class='hljl-n'>height</span><span class='hljl-p'>[</span><span class='hljl-n'>period</span><span class='hljl-oB'>-</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>period_hours</span><span class='hljl-p'>[</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>pumping</span><span class='hljl-p'>[</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-oB'>/</span><span class='hljl-ni'>3000</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-t'>
                    </span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-n'>hydro_height_reduction</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>period_hours</span><span class='hljl-p'>[</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>hydro</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>unit</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>hydrounits</span><span class='hljl-p'>),</span><span class='hljl-t'>
</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-cs'># cyclic - height at end must equal height at beginning</span><span class='hljl-t'>
</span><span class='hljl-nd'>@constraint</span><span class='hljl-p'>(</span><span class='hljl-t'>
    </span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>reservoir0</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>height</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>==</span><span class='hljl-t'> </span><span class='hljl-n'>height</span><span class='hljl-p'>[</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>period_hours</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>pumping</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-oB'>/</span><span class='hljl-ni'>3000</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-t'> </span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-n'>hydro_height_reduction</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>period_hours</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>hydro</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>unit</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>hydrounits</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-p'>)</span>
</pre>



<ul>
<li><p>SetCons #6. Total generator output &#40;thermal plus hydro&#41; for each time period must meet the given demand scenario plus pumping.</p>
</li>
</ul>


<pre class='hljl'>
<span class='hljl-cs'># Meet demand</span><span class='hljl-t'>
</span><span class='hljl-nd'>@constraint</span><span class='hljl-p'>(</span><span class='hljl-t'>
    </span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>meet_demand</span><span class='hljl-p'>[</span><span class='hljl-n'>period</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>nperiods</span><span class='hljl-p'>],</span><span class='hljl-t'>
    </span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-n'>output</span><span class='hljl-p'>[</span><span class='hljl-n'>type</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>type</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>ntypes</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'>
    </span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-n'>hydro_load</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>]</span><span class='hljl-oB'>*</span><span class='hljl-n'>hydro</span><span class='hljl-p'>[</span><span class='hljl-n'>unit</span><span class='hljl-p'>,</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>unit</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-n'>hydrounits</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>&gt;=</span><span class='hljl-t'>
    </span><span class='hljl-n'>demand</span><span class='hljl-p'>[</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>pumping</span><span class='hljl-p'>[</span><span class='hljl-n'>period</span><span class='hljl-p'>]</span><span class='hljl-t'>
</span><span class='hljl-p'>)</span>
</pre>



<hr />
<h3>Solving Deterministic Model</h3>
<p>Next, we start the optimization and HiGHS finds the optimal solution.</p>


<pre class='hljl'>
<span class='hljl-n'>JuMP</span><span class='hljl-oB'>.</span><span class='hljl-nf'>optimize!</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>)</span>
</pre>


<pre class="output">
Running HiGHS 1.8.1 &#40;git hash: 4a7f24ac6&#41;: Copyright &#40;c&#41; 2024 HiGHS under MIT licence terms
Coefficient ranges:
  Matrix &#91;1e-03, 4e&#43;03&#93;
  Cost   &#91;4e&#43;00, 9e&#43;03&#93;
  Bound  &#91;1e&#43;00, 1e&#43;00&#93;
  RHS    &#91;5e&#43;00, 4e&#43;04&#93;
Presolving model
69 rows, 75 cols, 205 nonzeros  0s
56 rows, 65 cols, 155 nonzeros  0s
46 rows, 45 cols, 117 nonzeros  0s

Solving MIP model with:
   46 rows
   45 cols &#40;0 binary, 30 integer, 0 implied int., 15 continuous&#41;
   117 nonzeros
MIP-Timing:     0.00054 - starting analytic centre calculation

Src: B &#61;&gt; Branching; C &#61;&gt; Central rounding; F &#61;&gt; Feasibility pump; H &#61;&gt; Heuristic; L &#61;&gt; Sub-MIP;
     P &#61;&gt; Empty MIP; R &#61;&gt; Randomized rounding; S &#61;&gt; Solve LP; T &#61;&gt; Evaluate node; U &#61;&gt; Unbounded;
     z &#61;&gt; Trivial zero; l &#61;&gt; Trivial lower; u &#61;&gt; Trivial upper; p &#61;&gt; Trivial point

        Nodes      |    B&amp;B Tree     |            Objective Bounds              |  Dynamic Constraints |       Work      
Src  Proc. InQueue |  Leaves   Expl. | BestBound       BestSol              Gap |   Cuts   InLp Confl. | LpIters     Time

         0       0         0   0.00&#37;   -inf            inf                  inf        0      0      0         0     0.0s
 R       0       0         0   0.00&#37;   981414.285714   981610             0.02&#37;        0      0      0        16     0.0s

30.0&#37; inactive integer columns, restarting
Model after restart has 19 rows, 20 cols &#40;0 bin., 12 int., 0 impl., 8 cont.&#41;, and 48 nonzeros

MIP-Timing:       0.017 - starting analytic centre calculation
         0       0         0   0.00&#37;   981414.285714   981610             0.02&#37;        0      0      0        16     0.0s
         0       0         0   0.00&#37;   981414.285714   981610             0.02&#37;        0      0      0        17     0.0s
         1       0         1 100.00&#37;   981610          981610             0.00&#37;        1      1      0        18     0.0s

Solving report
  Status            Optimal
  Primal bound      981610
  Dual bound        981610
  Gap               0&#37; &#40;tolerance: 0.01&#37;&#41;
  P-D integral      1.95943849505e-07
  Solution status   feasible
                    981610 &#40;objective&#41;
                    0 &#40;bound viol.&#41;
                    0 &#40;int. viol.&#41;
                    0 &#40;row viol.&#41;
  Timing            0.02 &#40;total&#41;
                    0.00 &#40;presolve&#41;
                    0.00 &#40;solve&#41;
                    0.00 &#40;postsolve&#41;
  Max sub-MIP depth 0
  Nodes             1
  Repair LPs        0 &#40;0 feasible; 0 iterations&#41;
  LP iterations     18 &#40;total&#41;
                    0 &#40;strong br.&#41;
                    1 &#40;separation&#41;
                    0 &#40;heuristics&#41;
</pre>


<p>Objective value:</p>


<pre class='hljl'>
<span class='hljl-n'>JuMP</span><span class='hljl-oB'>.</span><span class='hljl-nf'>objective_value</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>)</span>
</pre>


<pre class="output">
981610.0
</pre>


<hr />
<h2>Stochastic Model</h2>
<p>In this section we consider a stochastic variant of the problem. We assume that the load demand is uncertain from the second period on, but follows a known probability distribution.</p>
<p>The goal is to find an optimal set of power stations to turn on in order to satisfy the random power demand with a probability of at least <span class="math">$p_{level} \in [0,1]$</span>. The constraints &#40;SetCons #6&#41; above is replace with</p>
<ul>
<li><p><strong>Random Demand - continuous</strong> &#40;SetCons #6&#39;&#41;: Total power generated across all generator types must meet the random demand  plus pumping for each time period with probability <span class="math">$p_{level}$</span>:</p>
</li>
</ul>
<p class="math">\[
\mathbb{P}\left[\sum_{t \in \text{Types}}{\text{output}_{t,p}} +
\sum_{h \in \text{HydroUnits}}{\text{hydro_load}_h*\text{hydro}_{h,p}} \geq
\textbf{ demand}_p + \text{pumping}_p \quad \forall p \in \text{Periods}\right] \geq  p_{level}
\]</p>
<p>The uncertainties will be represented by <span class="math">$Nscen$</span> scenarios of demand, drawn from a  Gaussian probability distribution with average given by the vector <em>demand</em> above, and covariace matrix:</p>
<p class="math">\[
 Cov = \left[
  \begin{array}{llllllllll}
   265000&      475000&      650000&      700000\\
      475000&     1300000&      750000&     1650000\\
      650000&      750000&     2500000&     2000000\\
      700000&    1650000&     2000000&     4700000
     \end{array}\right]
\]</p>
<h2>Task 1</h2>
<p>Reformulate the above probability constraint by using <span class="math">$Nscen$</span> scenarios <span class="math">$\textbf{demand}_p^{i} \in R^5$</span> of demand, having probability <span class="math">$Pr_i$</span>, <span class="math">$i=1,\ldots,N$</span>.</p>
<h2>Task 2</h2>
<p>Generate <span class="math">$Nscen\geq 1$</span> correlated scenarios following the stated probability distribution. Set a seed for the random number generator: use np.random.seed&#40;0&#41;.</p>
<p>&#40;Hint: Generated <span class="math">$S \in R^{Nscen \times 4}$</span> from the standard normal distribution. Compute the Cholesky decomposition of <span class="math">$Cov = C^\top C$</span>. Set <span class="math">$Scen = demand + S\cdot C$</span>. Enlarge matrix <span class="math">$Scen$</span> by adding the first column with all values equal to <span class="math">$demand_1$</span>.&#41;</p>
<h2>Task 3</h2>
<p>Using your code for Task 2, generate a sample of <span class="math">$Nscen=300$</span> correlated scenarios. Assign the probability <span class="math">$Pr_i=1/Nscen$</span> for every scenario.</p>
<ul>
<li><p>a&#41; Plot this sample.</p>
</li>
<li><p>b&#41; What is the percentage of scenarios satisfied by the determinist solution?</p>
</li>
</ul>
<h2>Task 4</h2>
<p>Using the above sample, solve the resulting chance-constrained problem &#40;Task 1&#41; with probability level <span class="math">$p_{level}=0.9$</span>. Compare the following outputs with those from the deterministic model:</p>
<ul>
<li><p>a&#41; Costs</p>
</li>
<li><p>b&#41; Thermal production</p>
</li>
<li><p>c&#41; hydro production</p>
</li>
<li><p>d&#41; Pumping</p>
</li>
</ul>
<p>What happens when reliability is increased to <span class="math">$p_{level}=0.95$</span></p>
<h2>Task 5 &#40;Bonus&#41;</h2>
<p>This task is optional.</p>
<p>Generate a sample with <span class="math">$Nscen =1000$</span> scenarios. Pre-process this sample to reduce its size. Repeat Task 4 with this pre-processed sample.</p>
<hr />
<h2>References</h2>
<p>H. Paul Williams, Model Building in Mathematical Programming, fifth edition.</p>
<p>W. de Oliveira, Cours Mines 07 semaine PSL. Slides at www.oliveira.mat.br/teaching</p>


        <HR/>
        <div class="footer">
          <p>
            Published from <a href="UC.jmd">UC.jmd</a>
            using <a href="http://github.com/JunoLab/Weave.jl">Weave.jl</a> v0.10.12 on 2024-11-25.
          </p>
        </div>
      </div>
    </div>
  </div>
</BODY>

</HTML>
